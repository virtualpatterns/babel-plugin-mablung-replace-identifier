{"version":3,"sources":["../../source/library/visitor.cjs"],"names":["Parser","DefaultParser","ModuleParser","Visitor","BaseVisitor","constructor","babel","_programPath","_importIdentifier","nodeType","onProgramNode","path","onIdentifierNode","state","option","opts","rule","forEach","searchForPattern","Is","regexp","searchFor","RegExp","parserOption","test","node","name","null","addImport","type","source","InvalidImportTypeReplaceIdentifierError","replaceWith","replace","replaceWithNode","parseExpression"],"mappings":"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","sourcesContent":["import { addDefault as AddDefaultImport, addNamed as AddNamedImport, addNamespace as AddNamespaceImport, addSideEffect as AddSideEffectImport } from '@babel/helper-module-imports'\nimport Is from '@pwn/is'\nimport DefaultParser, * as ModuleParser from '@babel/parser'\nimport { Visitor as BaseVisitor } from '@virtualpatterns/mablung-babel-plugin/visitor'\n\nimport { InvalidImportTypeReplaceIdentifierError } from './error/invalid-import-type-replace-identifier-error.cjs'\n\nconst Parser = DefaultParser || ModuleParser\n\nclass Visitor extends BaseVisitor {\n\n  constructor(babel) {\n    super(babel)\n\n    this._programPath = null\n    this._importIdentifier = null\n\n  }\n\n  get nodeType() {\n    return [ 'Program', 'Identifier' ]\n  }\n\n  onProgramNode(path) {\n    // console.log(`Visitor.onProgramNode('${path.node.name}')`)\n\n    this._programPath = path\n    this._importIdentifier = null\n\n  }\n\n  onIdentifierNode(path, state) {\n    // console.log(`Visitor.onIdentifierNode('${path.node.name}', state)`)\n\n    let option = state.opts\n    let rule = option.rule\n\n    rule.forEach((rule) => {\n\n      rule.searchForPattern = rule.searchForPattern ? rule.searchForPattern : Is.regexp(rule.searchFor) ? rule.searchFor : new RegExp(rule.searchFor, 'gi')\n      rule.parserOption = rule.parserOption ? rule.parserOption : {}\n\n      if (rule.searchForPattern.test(path.node.name)) {\n\n        // console.log(`Replacing '${path.node.name}' with '${rule.replaceWith}'`)\n\n        // if (rule.parserOption) {\n        //   console.dir(rule.parserOption)\n        // }\n\n        if(Is.null(this._importIdentifier)) {\n\n          rule.addImport = rule.addImport ? rule.addImport : []\n          rule.addImport.forEach((addImport) => {\n\n            switch (addImport.type) {\n              case 'default':\n                this._importIdentifier = AddDefaultImport(this._programPath, addImport.source, addImport.option)\n                break\n              case 'named':\n                this._importIdentifier = AddNamedImport(this._programPath, addImport.name, addImport.source, addImport.option)\n                break\n              case 'namespace':\n                this._importIdentifier = AddNamespaceImport(this._programPath, addImport.source, addImport.option)\n                break\n              case 'sideEffect':\n                AddSideEffectImport(this._programPath, addImport.source)\n                break\n              default:\n                throw new InvalidImportTypeReplaceIdentifierError(addImport.type)\n            }\n            \n          })\n\n          rule.replaceWith = Is.null(this._importIdentifier) ? rule.replaceWith : rule.replaceWith.replace(/__importIdentifier/gi, this._importIdentifier.name)\n          rule.replaceWithNode = rule.replaceWithNode ?  rule.replaceWithNode : Parser.parseExpression(rule.replaceWith, rule.parserOption)\n  \n          this._importIdentifier = null\n\n        }\n\n        path.replaceWith(rule.replaceWithNode)\n\n      }\n\n    })\n\n  }\n\n}\n\nexport { Visitor }\n"],"file":"visitor.cjs"}